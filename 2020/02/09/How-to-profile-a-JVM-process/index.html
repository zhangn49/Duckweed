<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>How to profile a JVM process | Duckweed</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">How to profile a JVM process</h1><a id="logo" href="/.">Duckweed</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">How to profile a JVM process</h1><div class="post-meta">Feb 9, 2020</div><div class="post-content"><p>Recently I need to analyze why a HTTP GET API becomes slower in new version, and the server is implemented with Netty, which means it is a JVM process. So I googled how to profile a JVM process, and learned VisualVM is a visual tool integrating commandline JDK tools and lightweight profiling capabilities. It is great for this task, however, I did not find a pretty clear tech blog or document to profile a remote process. So I come back to my blog and write down how I did it.</p>
<h3 id="VisualVM"><a href="#VisualVM" class="headerlink" title="VisualVM"></a>VisualVM</h3><blockquote>
<p>VisualVM is a tool that provides a visual interface for viewing detailed information about Java applications while they are running on a Java Virtual Machine. <a href="https://en.wikipedia.org/wiki/VisualVM" target="_blank" rel="noopener">Wikipedia</a>.</p>
</blockquote>
<p>More important, it is a free tool.</p>
<h3 id="JMX"><a href="#JMX" class="headerlink" title="JMX"></a>JMX</h3><p>Honestly I know nothing about JMX and I thought it is very outdated but it helps.</p>
<blockquote>
<p>Java Management Extensions (JMX) is a Java technology that supplies tools for managing and monitoring applications, system objects, devices (such as printers) and service-oriented networks. Those resources are represented by objects called MBeans (for Managed Bean).</p>
</blockquote>
<h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3><h5 id="1-Allow-TCP-forwarding"><a href="#1-Allow-TCP-forwarding" class="headerlink" title="1. Allow TCP forwarding"></a>1. Allow TCP forwarding</h5><p>Since we need to utilize ssh connection to forward some port for JMX and RMI, we need allow TCP forwarding. </p>
<p>Edit /etc/ssh/sshd_config, set <figure class="highlight plain"><figcaption><span>to ```yes```, then restart sshd by ```service sshd restart```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 2. Pick up and expose ports</span><br><span class="line">Before adding some flags, pick up two ports for each process you want to profile, like 9010 and 9011 that are not used by other process, and expose ports in Linux by</span><br></pre></td></tr></table></figure></p>
<p>sudo iptables -A INPUT -p tcp –dport 9010 -j ACCEPT<br>sudo iptables -A OUTPUT -p tcp –dport 9010 -j ACCEPT<br>sudo iptables -A INPUT -p tcp –dport 9011 -j ACCEPT<br>sudo iptables -A OUTPUT -p tcp –dport 9011 -j ACCEPT<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### <span class="number">3.</span> Add flags when start java process</span><br></pre></td></tr></table></figure></p>
<p>-Dcom.sun.management.jmxremote<br>-Dcom.sun.management.jmxremote.port=9010<br>-Dcom.sun.management.jmxremote.rmi.port=9011<br>-Dcom.sun.management.jmxremote.local.only=false<br>-Dcom.sun.management.jmxremote.authenticate=false<br>-Dcom.sun.management.jmxremote.ssl=false<br>-Djava.rmi.server.hostname={IP address eg. 10.110.31.69}<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Then start your JAVA process.</span><br><span class="line"></span><br><span class="line">##### <span class="number">4.</span> Establish SSH Tunnel</span><br></pre></td></tr></table></figure></p>
<p>ssh -l username IP-Address-of-VM -L 9010:localhost:9010 -L 9011:localhost:9011<br><code>`</code></p>
<h5 id="5-Open-VisualVM-to-sample"><a href="#5-Open-VisualVM-to-sample" class="headerlink" title="5. Open VisualVM to sample"></a>5. Open VisualVM to sample</h5><p>Open VisualVM application, on the left pannel click right on local then add new jmx connection.<br>For the connection config put localhost:9010, then click OK.<br>Now you can open the connection and start monitoring your application. You can sample CPU then send a request to collecting profiling data.</p>
</div><div class="tags"><a href="/tags/JVM-Profiling/">JVM, Profiling</a></div><div class="post-nav"><a href="/2018/09/21/Desigining-Data-Intensive-Applications/" class="next">Reliable, Scalable, and Maintainable Applications in DDIA</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://zhangn49.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/JVM-Profiling/" style="font-size: 15px;">JVM, Profiling</a> <a href="/tags/Notes/" style="font-size: 15px;">Notes</a> <a href="/tags/Alogrithms/" style="font-size: 15px;">Alogrithms</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/09/How-to-profile-a-JVM-process/">How to profile a JVM process</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/21/Desigining-Data-Intensive-Applications/">Reliable, Scalable, and Maintainable Applications in DDIA</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/09/Cracking-the-Binary-Search/">Cracking the Binary Search</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/20/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/zhangn49" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://weibo.com/all4win2009" title="Weibo" target="_blank">Weibo</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Duckweed.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>